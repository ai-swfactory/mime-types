name: Release

on:
  push:
    branches: [main]

concurrency:
  group: ${{ github.repository }}-release
  cancel-in-progress: false

permissions:
  contents: write
  packages: write
  issues: write
  pull-requests: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Checkout ai-swfactory/actions-dist
        uses: actions/checkout@v4
        with:
          repository: ai-swfactory/actions-dist
          token: ${{ secrets.AI_SWFACTORY_PACKAGES_TOKEN }}
          path: .github/ai-swfactory-actions
          sparse-checkout: semantic-release

      - name: Run semantic release
        uses: ./.github/ai-swfactory-actions/semantic-release
        with:
          github-token: ${{ github.token }}
          npm-token: ${{ secrets.AI_SWFACTORY_PACKAGES_TOKEN }}
